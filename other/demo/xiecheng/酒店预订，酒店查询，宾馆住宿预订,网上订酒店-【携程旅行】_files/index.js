/**
 * @license RequireJS text 2.0.5+ Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

define("BizCityList",["HotelModel","HotelStore","Toolkit"],function(e,t,n){function l(e,t){var i=0,l=null,c=n.deepClone(f),h=null,p="";e=r.restoreData(e);if(!(e&&e.cities&&e.cities.length>0))return;return e.cities=_.sortBy(e.cities,function(e){return e.idx}),_.each(e.cities,function(e,t){e.type==2&&e.ctryId<2&&(e.type=1),p=e.cname.trim(),p.indexOf("市")>0&&(p=p.replace("市","").trim()),c.wordList[p]=e,c.hotCities.length<21&&!!e.hot?c.hotCities.push(e):!e.cfrl||(l=e.cfrl.toUpperCase().trim(),h=c.categoryCities[l],!!h&&h.length>0?h.push(e):(h=[],h.push(e)),c.categoryCities[l]=h)}),_.each(c.hotCities,function(t,n){_.each(e.cities,function(n,r){t.cityId===n.cityId&&!n.hot&&n.did<0&&e.cities.splice(r,1)})}),c.cityList=e.cities,s.setAttr(t,c.cityList),o.setAttr(t,c.categoryCities),u.setAttr(t,{historyCities:c.historyCities,hotCities:c.hotCities}),a.setAttr(t,c.wordList),c}function c(e,t){var n=null;i.excute(function(r){!!r&&!!t&&(n=l(r,t)),_.isObject(e)&&n&&e.success(n)},function(t){typeof e.error=="function"&&e.error(t)},!1,this)}var r={},i=e.cityListModel.getInstance(),s=t.protoCityListStore.getInstance(),o=t.renderCategoryCitiesStore.getInstance(),u=t.renderHisHotCityListStore.getInstance(),a=t.wordsCityListStore.getInstance(),f={historyCities:[],hotCities:[],categoryCities:{A:[],B:[],C:[],D:[],E:[],F:[],G:[],H:[],I:[],J:[],K:[],L:[],M:[],N:[],O:[],P:[],Q:[],R:[],S:[],T:[],U:[],V:[],W:[],X:[],Y:[],Z:[]},cityList:null,wordList:{}};return r.restoreData=function(e){var t=[],n={},r=[];return!!e&&e.cities&&e.cities.length>0&&!!e.hash&&(_.each(e.hash,function(e,t){r[e]=t}),_.each(e.cities,function(e,i){n=_.object(r,e),t.push(n)}),e.cities=t),e},r.getInLandCityList=function(e){i.setParamStore({type:1}),c(e,"inland")},r.getOverseaCityList=function(e){i.setParamStore({type:2}),c(e,"oversea")},r.getCityByName=function(e,t){function s(e){var t=null;!!e&&e.indexOf("市")>0&&(e=e.replace("市","").trim());try{t=i[e]}catch(n){}return t}var n=this,r=null,i=a.getAttr("inland");if(!!i&&!_.isEmpty(i)){if(!!e){r=s(e.name);if(!!t)return r;typeof e.callback=="function"&&e.callback(r)}}else n.getInLandCityList({success:function(){r=n.getCityByName(e,!0),typeof e.callback=="function"&&e.callback(r)},error:function(){typeof e.error=="function"&&e.error()}})},r.getCityByID=function(e,t){function s(e,t){var n=null;for(var r in i)if(i[r].cityId==e&&i[r].did<=0)n=i[r];else if(i[r].cityId==e&&!!t&&i[r].did===t)return i[r];return n}var n=this,r=null,i=a.getAttr("inland");if(!!i&&!_.isEmpty(i)){if(!!e){r=s(e.id,e.did);if(!!t)return r;typeof e.callback=="function"&&e.callback(r)}}else n.getInLandCityList({success:function(){r=n.getCityByID(e,!0),typeof e.callback=="function"&&e.callback(r)},error:function(){typeof e.error=="function"&&e.error()}})},r.getOverseaCityByID=function(e,t){function o(e,t){var n=null;for(var r in i)if(i[r].cityId==e&&i[r].did<=0)n=i[r];else if(i[r].cityId==e&&!!t&&i[r].did===t)return i[r];return n}var n=this,r=null,i=s.getAttr("oversea");if(!!i&&!_.isEmpty(i)){if(!!e){r=o(e.id,e.did);if(!!t)return r;typeof e.callback=="function"&&e.callback(r)}}else n.getOverseaCityList({success:function(){r=n.getOverseaCityByID(e,!0),typeof e.callback=="function"&&e.callback(r)},error:function(){typeof e.error=="function"&&e.error()}})},r.cleanCityName=function(e){var t=/[\s|(]+/,n=e,r=[];return t.test(n)&&(r=n.split(t),r[0].length>0&&(n=r[0])),n},r.parseOverseaCityName=function(e){var t=null;return!_.isObject(e)||_.isEmpty(e)?null:(_.isEmpty(e.seo)?!e.cEN||(r.getOverseaCityByID({id:e.cityId,callback:function(e){!e||(t=e.seo)}}),t||(t=e.cEN)):t=e.seo,t)},r}),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h=[],p=e.config&&e.config()||{};t={version:"2.0.5+",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("text!/webapp/hotel/dest/templates/pricestar.html",[],function(){return'<div class="hotel-p-s-filter js_price_star_filter"></div>\r\n\r\n<script type="text/template" id="tpl_price_star">\r\n    <dl>\r\n       <dt>价格(单选)</dt>\r\n       <dd class="current js_price_h js_price_all">不限</dd>\r\n       <% for (var i = 0, len = priceData.length; i < len; i++) { %>\r\n           <% for (var k in priceData[i]) { %>\r\n               <dd class="js_price_h" data-price="<%= k %>"><%= priceData[i][k] %></dd>\r\n           <% } %>\r\n       <% } %>\r\n       <% if (notInland) { %>\r\n           <dt><a href="#" class="hotel-font-color fr js_starinfo">海外酒店钻级说明</a>钻级(复选)</dt>\r\n       <% } else { %>\r\n           <dt>星级(复选)</dt>\r\n       <% } %>\r\n       <dd class="current js_star_h js_star_all">不限</dd>\r\n       <% for (var i = 0, len = starData.length; i < len; i++) { %>\r\n           <% for (var k in starData[i]) { %>\r\n               <dd class="js_star_h" data-star="<%= k %>" data-text="<%= starData[i][k] %>"><%= starData[i][k] %></dd>\r\n           <% } %>\r\n       <% } %>\r\n       <div class="mt10">\r\n           <button class="g_btn_s js_price_star_filter_ok">确定</button>\r\n       </div>\r\n    </dl>\r\n</script>\r\n\r\n<script type="text/template" id="tpl_price_star_info">\r\n    <header>\r\n        <h1>海外酒店钻级说明</h1><i class="returnico"></i>\r\n    </header>\r\n    <article class="p10 cont_wrap">\r\n        <p>海外酒店的星级一般为非官方的酒店自评，携程在此基础上参考客户评价给予钻级划分，供预订酒店时参考。（友情提示：正常情况下海外酒店的设施标准可能低于同星级的国内酒店，请在预订前详细参考酒店各方面信息。）</p>\r\n        <h2>一钻（经济型酒店）</h2>\r\n        <p>提供背包族最基本的食宿条件。客房多数面积较小，简单装修，且大部分房间不提供独立的洗手间和电话。</p>\r\n        <h2>二钻（经济型酒店）</h2>\r\n        <p>除一钻酒店提供的服务以外，部分二钻酒店还可提供商务服务。但一般不提供会议服务、行李寄存以及健身娱乐设施。</p>\r\n        <h2>三钻（舒适酒店）</h2>\r\n        <p>三钻酒店提供舒适、贴心和人性化的服务，酒店内设施齐备。相比二钻酒店提供更多的生活必需品，客房装饰也更舒适考究。</p>\r\n        <h2>四钻（高档酒店）</h2>\r\n        <p>四钻酒店客房精心设计、装修豪华、布置典雅。部分酒店可提供全面的商务服务和先进的会议设施。</p>\r\n        <h2>五钻（豪华酒店）</h2>\r\n        <p>五钻酒店将提供最舒适、最贴心的服务。酒店装修豪华典雅，除提供必须设施，还可提供其它增值服务。</p>\r\n    </article>\r\n</script>\r\n'}),define("PriceStar",["libs","cBase","cUIAbstractView","cUIMask","cUIHashObserve","HotelStore","text!/webapp/hotel/dest/templates/pricestar.html"],function(e,t,n,r,i,s,o){var u=$(o),a={cn:{price:[{"0,150":"￥150元以下"},{"150,300":"￥150-￥300"},{"301,450":"￥301-￥450"},{"451,600":"￥451-￥600"},{"601,1000":"￥601-￥1000"},{1e3:"￥1000以上"}],star:[{liansuo:"快捷连锁"},{"0|1|2":"二星级及以下/经济"},{3:"三星级/舒适"},{4:"四星级/高档"},{5:"五星级/豪华"}]},tw:{price:[{"0,400":"&yen;400以下"},{"401,700":"&yen;401-&yen;700"},{"701,1000":"&yen;701-&yen;1000"},{"1001,1300":"&yen;1001-&yen;1300"},{"1301,1800":"&yen;1301-&yen;1800"},{1800:"&yen;1800以上"}],star:[{"0|1|2":"二钻及以下/经济"},{3:"三钻/舒适"},{4:"四钻/高档"},{5:"五钻/豪华"}]}},f=new t.Class(n,{__propertys__:function(){this.hashObserve=new i({hash:this.id,callback:function(){this._hide()},scope:this}),this.mask=new r,this.inited=!1,this.notInland=!1,this.starIntroView={}},bindEvent:function(){var e=this,t=_.template(u.filter("#tpl_price_star").html());this.addEventType("onSave"),this.addEvent("onCreate",function(){e.root.find(".js_price_star_filter").css("z-index",9999),e.priceStarTextEl=null,e.root.on("click",".js_price_h",function(t){e.checkPrice(t)}),e.root.on("click",".js_star_h",function(t){e.checkStar(t)}),e.root.on("click",".js_price_star_filter_ok",function(t){e.save()}),e.root.on("click",".js_starinfo",function(t){t.preventDefault(),e.starIntroView._show(e.mask)})}),this.addEvent("onShow",function(){e.root.find(".js_price_star_filter").html(t({notInland:e.notInland,priceData:e.priceData,starData:e.starData})),e.root.on("touchmove",function(){return!1}),e.hashObserve.start()}),this.addEvent("onHide",function(){e.root.off("touchmove"),e.hashObserve.end(),e.callbackOnHide&&e.callbackOnHide()})},initialize:function($super,e){this.bindEvent(),this.addClass("cui-pricestar"),this.starIntroView=e,$super(e)},createHtml:function(){return o},_show:function(e,t,n,r,i){var s=this;this.updateText(e),this.priceStarTextEl=i||this.priceStarTextEl,this.callback=r,this.show(),this.mask.show(),this.updatePriceStarSelected(e,t,n,i),this.mask.isCreate&&!this.inited&&(this.inited=!0,this.mask.root.on("click",function(){s._hide()}))},_hide:function(){this.mask.hide(),this.hide()},onHide:function(e){this.callbackOnHide=e},save:function(){var e=this.root.find(".js_price_h.current"),t=this.root.find(".js_star_h.current"),n={value:0,text:""},r={value:[],text:[]};n.value=e.attr("data-price")||0,n.text=$.trim(e.text())||"",t.each(function(){var e=$(this);e.length&&(r.value.push(e.attr("data-star")||""),r.text.push(e.attr("data-text")||""))}),this._hide(),this.updatePriceStarText(null,n,r,this.priceStarTextEl),this.callback&&this.callback(n,r)},checkPrice:function(e){this.root.find(".js_price_h").removeClass("current"),$(e.currentTarget).addClass("current")},checkStar:function(e){$(e.currentTarget).hasClass("js_star_all")?this.root.find(".js_star_h").removeClass("current"):this.root.find(".js_star_h").eq(0).removeClass("current"),$(e.currentTarget).toggleClass("current"),this.root.find(".js_star_h.current").length==0&&this.root.find(".js_star_h").eq(0).addClass("current")},updatePriceStarText:function(e,t,n,r){if((!r||_.isEmpty(r))&&_.isEmpty(this.priceStarTextEl))return;this.priceStarTextEl=r||this.priceStarTextEl,this.updateText(e);var n=n||{},t=t||{},i=this,s=[];if(t){var o=_.compact(_.pluck(this.priceData,t.value))||[],u=o.join("")||"";u&&s.push(u)}if(n&&n.value){var a=_.map(n.value,function(e,t){var n=_.compact(_.pluck(i.starData,e));if(n.length)return n});a=_.uniq(a),a&&a.length&&(s=_.compact(s.concat(a)))}s&&s.length?this.priceStarTextEl.html(s.join(", ")):this.priceStarTextEl.html("不限")},updatePriceStarSelected:function(e,t,n,r){this.priceStarTextEl=r||this.priceStarTextEl,this.updatePriceStarText(e,t,n,r);if(!this.isCreate)return!1;var t=t||{},n=n||{},i=[],s=this.root.find(".js_price_h"),o=[],u=this.root.find(".js_star_h"),a=0;t.value?(i=s.filter('[data-price="'+t.value+'"]'),s.removeClass("current"),i.length?i.addClass("current"):s.eq(0).addClass("current")):(s.removeClass("current"),s.eq(0).addClass("current"));if(n.value&&n.value.length){u.removeClass("current");for(var f=0,l=n.value.length;f<l;f++)o=u.filter('[data-star="'+n.value[f]+'"]'),o.length&&(o.addClass("current"),a++);a||u.eq(0).addClass("current")}else u.removeClass("current"),u.eq(0).addClass("current")},updateText:function(e){if(!e)return;this.notInland=e!=1;var t=this.notInland?"tw":"cn";this.priceData=a[t].price,this.starData=a[t].star}}),l=new t.Class(n,{__propertys__:function(){this.hashObserve=new i({hash:this.id,callback:function(){this.hide()},scope:this})},bindEvent:function(){var e=this;this.addEventType("onSave"),this.addEvent("onCreate",function(){e.setRootStyle(),e.root.find(".js_price_star_filter").css("z-index",9999),e.priceStarTextEl=null,e.root.on("click",".returnico",function(t){e.hide()})}),this.addEvent("onShow",function(){e.hashObserve.start(),$("#main").add(this.maskRoot).hide()}),this.addEvent("onHide",function(){e.hashObserve.end(),$("#main").add(this.maskRoot).show()})},initialize:function($super,e){this.bindEvent(),this.addClass("cui-starintro"),$super(e)},createHtml:function(){return u.filter("#tpl_price_star_info").html()},setRootStyle:function(){this.root.css({position:"absolute",left:"0px",top:"0px",background:"#f5f5f5",zIndex:"10000",width:"100%",minHeight:"100%",overflow:"visible"})},_show:function(e){this.maskRoot=e&&e.root,this.show()}}),c=function(){var e=new l,t=new f(e);this.show=function(e,n,r,i,s){t._show(e,n,r,i,s)},this.hide=function(){t._hide()},this.onHide=function(e){t.onHide(e)},this.updatePriceStarSelected=function(e,n,r,i){t.updatePriceStarSelected(e,n,r,i)}};return c.StarTitleSorts={"快捷连锁":0,"二钻及以下/经济":0,"二星级及以下/经济":1,"三钻/舒适":1,"三星级/舒适":2,"四钻/高档":2,"四星级/高档":3,"五钻/豪华":3,"五星级/豪华":4},c}),define("HotelFilterModel",["HotelBaseModel","OldRestfulModel","cBase","HotelStore","HotelModel"],function(e,t,n,r,i){var s={};return s.HotelFilterTypeModel=new n.Class(i.HotelFilterTypeModel,{__propertys__:function(){},initialize:function($super,e){$super(e)},getAreaTitles:function(e,t,n,r){this._collectParam();var i=this,s=function(n){var s=this.keyMaps||this._getkeyMaps(n),o={};_.each(e,function(e,t){var r=s[t];if(!r){o[t]=null;return}o[t]={};var u,a;i._dispose[t]&&(_.isArray(e)?(u={},_.each(e,function(e,s){a=i._dispose[t].call(i,e.id,t,n[r]||{},e.sid),u[e.id]=a}),o[t]=u):o[t]=i._dispose[t].call(i,e.id,t,n[r]||{},e.sid))}),t.call(r||this,o)},i=this;this.excute(function(e){s.call(i,e)},function(e){n&&n(e)},!1,r||this)},getAreaInfos:function(e,t,n,r){this._collectParam(),e=e||{};var i=this,s=parseInt(e.mtype),o=e.id,u=e.sid,a=function(e){var n=this.keyMaps||this._getkeyMaps(e),a={};if(s!==-1){var f=n[s];if(!f){t.call(r||this,null);return}}a[s]={};var l,c,h;i._dispose[s]&&(h=(s===-1?e:e[f])||{},s===-1?a=i._dispose[s].call(i,o,s,h,u,f):a[s]=i._dispose[s].call(i,o,s,h,u,f)),t.call(r||this,a)},i=this;this.excute(function(e){a.call(i,e)},function(e){n&&n(e)},!1,r||this)},_collectParam:function(){var e=r.Morning.getInstance(),t=r.SearchParam.getInstance(),i=t.getAttr("city.cityId")||2,s=t.getAttr("inDay"),o=t.getAttr("outDay");if(e.isMorning()){var u=new n.Date.parse(s);u.addDay(-1),s=u.format("Y-m-d")}this.setParam("cityId",+i),this.setParam("cidate",s),this.setParam("codate",o)},getTitles:function(e,t,n,r){this._collectParam();var i=this,s=function(n){var s=this.keyMaps||this._getkeyMaps(n),o={};_.each(e,function(e,t){var r=s[t];if(!r){o[t]=null;return}o[t]={};var u,a;i._dispose[t]&&(_.isArray(e)?(u={},_.each(e,function(e,s){a=i._dispose[t].call(i,e,t,n[r]||{}),u[e]=a}),o[t]=u):(u={},u[e]=i._dispose[t].call(i,e,t,n[r]||{}),o[t]=u))}),t.call(r||this,o)},i=this;this.excute(function(e){s.call(i,e)},function(){n&&n()},!1,r||this)},_getkeyMaps:function(e){var t={};return _.each(e,function(e,n){e&&e.mtype&&(t[e.mtype]=n)}),this.keyMaps=t},_cache:{},_substrateCache:{},_subcache:{},_subextra:{},_airportsextra:{},_dispose:{"-1":function(e,t,n,r,i){var s=n.ariportObj,o=this._dispose[4].call(this,e,4,s||{});if(o&&o.title)return o.mtype=4,o={4:o},o;var u=n.spotObj,a=this._dispose[9].call(this,e,9,u||{});return a&&a.title?(a.mtype=9,a={9:a},a):{id:e,title:""}},1:function(e,t,n){var r={},i=this._cache[t]||function(e){var n={};return _.each(e.zones||[],function(e,t){n[e.id]=e.name}),this._cache[t]=n}.call(this,n);return r.id=e,r.mtype=1,r.title=i[e],r},2:function(e,t,n){var r={},i=this._cache[t]||function(e){var n={};return _.each(e.locations||[],function(e,t){n[e.id]=e.name}),this._cache[t]=n}.call(this,n);return r.id=e,r.mtype=2,r.title=i[e],r},3:function(e,t,n,r){var i=this._cache[t]||function(e){var n={},r={};return _.each(e.metros||[],function(e,t){n[e.metId]=e.metName,r[e.metId]=e.stations}),this._substrateCache[t]=r,this._cache[t]=n}.call(this,n),s={};!e&&r&&(e=this._getIdBySid(this._substrateCache[t],r)),s.id=e,s.mtype=3,i[e]&&(s.title=i[e]);if(r>-1){var o=this._subcache[t+"_"+e]||function(){var n={},r={};return _.each(this._substrateCache[t][e],function(e,t){n[e.sid]=e.sname,r[e.sid]=e}),this._subextra[t+"_"+e]=r,this._subcache[t+"_"+e]=n}.call(this,n),u=this._subextra[t+"_"+e]||{};if(o[r]){var a=u[r]||{};s.sid=r,s.sname=o[r],s.lat=a.cordinfo&&a.cordinfo.lat,s.lon=a.cordinfo&&a.cordinfo.lon}}return s},4:function(e,t,n){var r={},i=this,s=this._cache[t]||function(e){var n={},r={};return _.each(e.airports||[],function(e,t){n[e.sid]=e.sname,r[e.sid]=e}),i._airportsextra[t]=r,this._cache[t]=n}.call(this,n),o=i._airportsextra[t],u=o[e]||{};return u&&(r.lat=u.cordinfo&&u.cordinfo.lat,r.lon=u.cordinfo&&u.cordinfo.lon),r.id=e,r.mtype=4,r.title=s[e],r},5:function(e,t,n){var r=this._cache[t]||function(e){var n={};return _.each(e.brands||[],function(e,t){n[e.id]={biz:e.biz,title:e.name}}),this._cache[t]=n}.call(this,n);return r[e]},6:function(e,t,n){var r=this._cache[t]||function(e){var n={};return _.each(e.events||[],function(e,t){n[e.eid]=e.name}),this._cache[t]=n}.call(this,n);return r[e]},8:function(e,t,n){var r=this._cache[t]||function(e){var n={};return _.each(e.features||[],function(e,t){n[e.id]=e.name}),this._cache[t]=n}.call(this,n);return r[e]},9:function(e,t,n){var r={},i=this._cache[t]||function(e){var n={};return _.each(e.spots||[],function(e,t){n[e.id]=e}),this._cache[t]=n}.call(this,n);r.id=e,r.mtype=9,r.title=i[e]&&i[e].name;if(i[e]&&i[e].cordinfo&&i[e].cordinfo.length){var s=i[e].cordinfo.pop();r.lat=s&&s.lat,r.lon=s&&s.lon}return r}},_getIdBySid:function(e,t){var n,r;for(var i in e){n=e[i];for(var s=0,o=n.length;s<o;s++){r=n[s];if(t==r.sid)return parseInt(i)}}return null}}),s}),define(["c","Toolkit","BizCityList","History","cCommonPageFactory","CommonStore","cWidgetFactory","cGeoService2","cWidgetCalendar","cUITab","PriceStar","HotelStore","HotelModel","HotelFilterModel","HotelBaseView"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=e.base,v=i.create("HotelBaseView"),m=u.GeoLocation,g=o.create("Calendar"),y=d.Date,b={inLand:"212092",overSea:"229001"},w=c.HotelQueryStore.getInstance(),E=c.SearchParam.getInstance(),S=c.SelectedCityStore.getInstance(),x=c.HotelFilterTypeParamStore.getInstance(),T=c.Morning.getInstance(),N=h.cityListModel.getInstance(),C=p.HotelFilterTypeModel.getInstance(),k=c.PositionlStore.getInstance(),L="我附近的酒店",A=new l,O=v.extend({pageid:"212092",hasAd:!0,stayCount:1,roomsCount:1,cidat:0,codat:0,hasCityId:!1,locateInfo:{status:!0,msg:""},isMorning:!1,go2KWCat:function(){if(this.locating===!0){this.wannaKeyWord=!0,this.showLocating(!0);return}var e=w.getAttr("city");e&&e.cityId?(this.hasCityId=!!e.cityId,this.hasCityId&&this.forwardJump("querykeywords","/webapp/hotel/querykeywords")):k.get()?this.geoErrorOverSea():(this.wannaKeyWord=!0,this.showLocating(!0),this.getPosition())},updateKeywords:function(e){var t=this,n=w.getAttr("kwText");if(e){n="";var r={query:[],kwText:"",kwCurCatType:"",kwCurVal:null,kwHasGeos:null,brand_filter:null};w.setAttr(r)}n?this.els.keywordsTextBox.removeClass("hotel-fontgrey").html(n):this.els.keywordsTextBox.addClass("hotel-fontgrey").html("关键字/位置/品牌/酒店名")},clearPriceStarInStoreHotelQuery:function(){var e=w.get()||{};e.price=null,e.star=null,e.days=1,e.rooms=1,w.set(e),this.initPriceStar()},getPosition:function(e,t){var r=null,i=this,s=null,o={lat:0,lng:0};e=e===!1?!1:!0,this.locateInfo.status=!1,this.updateKeywords(!0),this.clearPriceStarInStoreHotelQuery(),m.Subscribe("hotel/index",{onStart:function(){i.els.city.html(L),i.startGeoStatus()},onComplete:function(e){var r=this;k.set(e),w.setAttr("address",e),w.setAttr("isSearchListWithCity",!1);var s=r.checkAddress(e);s?(r.locateInfo.status=!0,r.goToInland(null,e),n.getCityByName({name:e.city,callback:function(e){r.stopGeoStatus(),r.clearCityData(),e.cname=L,w.setAttr("city",e),w.setAttr("positionCity",e),r.hasCityId=!0,typeof t=="function"&&t(),i.wannaSearchList===!0?(i.wannaSearchList=null,i.submitAction()):i.wannaKeyWord===!0?(i.wannaKeyWord=null,i.go2KWCat()):i.wannaPriceStar===!0&&(i.wannaPriceStar=null,i.showPriceStar())},error:function(){r.stopGeoStatus(),w.setAttr("city",null),w.setAttr("positionCity",null),r.hasCityId=!1}})):(r.goToOversea(null,e),r.locateInfo.status=!0,r.stopGeoStatus(),e.lat=o.lat,e.lng=o.lng,e.location=o.lng+","+o.lat,k.set(e),w.setAttr("address",e),w.setAttr("city",null),w.setAttr("positionCity",null),typeof t=="function"&&t(),i.wannaSearchList===!0?(i.wannaSearchList=null,i.submitAction()):i.wannaKeyWord===!0?(i.wannaKeyWord=null,i.geoErrorOverSea()):i.wannaPriceStar===!0&&(i.wannaPriceStar=null,i.showPriceStar()))},onError:this.geoError,onPosComplete:function(e,t){o.lat=t,o.lng=e},onPosError:this.geoError},this,e)},geoError:function(t){var n=this;n.stopGeoStatus(),k.set(null),w.setAttr("address",null),w.setAttr("city",null),w.setAttr("isSearchListWithCity",!0),this.alert=new e.ui.Alert({title:"提示信息",message:"定位失败，您可以通过在设置中开启定位服务，开启WIFI，以提高定位成功率；或选择城市查询",buttons:[{text:"知道了",type:e.ui.Alert.STYLE_CANCEL,click:function(){this.hide()}},{text:"选择城市",click:function(){this.hide(),n.eventSelectCity()}}]}),n.wannaSearchList===!0?(n.wannaSearchList=null,this.alert.show()):n.wannaKeyWord===!0?(n.wannaKeyWord=null,this.alert.show()):n.wannaPriceStar===!0&&(n.wannaPriceStar=null,this.alert.show()),this.locateInfo.status=!0,this.hasCityId=!0},geoErrorOverSea:function(t){var n=this;this.stopGeoStatus(),this.alert=new e.ui.Alert({title:"提示信息",message:"请您先选择入住城市",buttons:[{text:"知道了",type:e.ui.Alert.STYLE_CANCEL,click:function(){this.hide()}},{text:"选择城市",click:function(){this.hide(),n.eventSelectCity()}}]}),this.alert.show(),this.locateInfo.status=!0,this.hasCityId=!0},startGeoStatus:function(){this.els.geoIcon.hide(),this.els.geoIconLoading.show(),this.locating=!0,w.setAttr("address",null),w.setAttr("city",null),w.setAttr("positionCity",null),k.set(null)},stopGeoStatus:function(){this.els.geoIcon.show(),this.els.geoIconLoading.hide(),this.locating=!1,this.hideLocating()},showCalendar:function(){!this.calendar&&this.createCalendar();var e=this.cidat;this.calendar.update({date:{departdate:{title:function(e,t){var n=t(e),r="";return parseInt(n,10)?r="<em>"+n+"</em><em>入住</em>":r="<em>"+y.format(e,"j")+"</em><em>"+t(e)+"</em>",r},value:e}}}),$(".fix_bottom").css("z-index",3e3),this.calendar.show()},createCalendar:function(){var e=this.getServerDate(),t=this;this.calendar=new g({date:{departdate:{title:function(e,t){var n=t(e),r="";return parseInt(n,10)?r="<em>"+n+"</em><em>入住</em>":r="<em>"+y.format(e,"j")+"</em><em>"+t(e)+"</em>",r},value:e}},title:"选择日期",callback:function(e,n,r,i){this._hide();var s=typeof t.stayCount=="object"?t.stayCount.getVal():1,o=new y(t.getServerDate());t.cidat=new y(r.departdate);var u=y.getIntervalDay(o.format("Y-m-d"),t.cidat.format("Y-m-d"))===0;t.isMorning=u?t.isMorning:!1,t.isMorning&&(s-=1),T.setStatus(t.isMorning),t.codat=(new y(t.cidat)).addDay(s),t.dateInfo=i,t.updateStoreDate(t.cidat.format("Y-m-d"),t.codat.format("Y-m-d")),t.updateHtmlDate(),t.checkMorning(),$(".fix_bottom").css("z-index",9999)},Months:6,onCreate:function(){},onShow:function(){},onHide:function(){}})},updateStoreDate:function(e,t){w.setAttr("inDay",e),w.setAttr("outDay",t)},updateHtmlDate:function(e){var t=new y(this.getServerDate()),n="",r="";this.dateInfo=this.dateInfo||{holiday:"",chineseday:""};var i=y.getIntervalDay(t.format("Y/m/d"),this.cidat.format("Y/m/d")),s=this.codat.format("n月j日")+"<br>("+y.weekday(this.codat)+")离店";r=this.cidat.format("Y年n月j日");switch(i){case 0:n="今天";break;case 1:n="明天";break;case 2:n="后天";break;default:n=this.cidat.format("n月j日"),r=this.codat.format("Y年 ")+y.weekday(this.cidat),this.dateInfo.holiday==""&&this.dateInfo.chineseday==""?r=this.codat.format("Y年 ")+y.weekday(this.cidat):r=this.codat.format("Y年 ")+(this.dateInfo.holiday==""?this.dateInfo.chineseday:this.dateInfo.holiday)}if(i==1||i==0||i==2)if(this.dateInfo.holiday!=""||this.dateInfo.chineseday!="")r=this.codat.format("Y年 ")+(this.dateInfo.holiday==""?this.dateInfo.chineseday:this.dateInfo.holiday);this.els.checkInDateLeft.text(n),this.els.checkInDateRight.text(r),this.els.checkOutDate.html(s)},submitAction:function(){if(this.locating===!0){this.wannaSearchList=!0,this.showLocating(!0);return}var t="",r=this,i=function(e){var i="shanghai2/";if(_.isObject(e)){var s="",o="";if(r.isOutlandCity(e)){var u=n.parseOverseaCityName(e);r.setType(2),t="/webapp/hotel/oversea/",s=n.cleanCityName(u)}else t="/webapp/hotel/",s=n.cleanCityName(e.cPY);s||(s="city"),e.did>0&&(o="D"+e.did+"_"),i=t+s+o+e.cityId+"/"}return i};this.validateStoreDate(),this.validateStoreGeo();var s=w.get(),o=[];this.isMorning&&o.push("ismorning=1"),w.getAttr("isSearchListWithCity")||o.push("geo=1"),w.setAttr("biz",this.getType()),w.setAttr("contrl",3),w.setAttr("facility",0),w.setAttr("pay",0),w.setAttr("by",0),w.setAttr("direct",1),w.setAttr("area_filter",[]),x.set({}),E.set(w.get()),E.setAttr("query_filter",E.getAttr("query")),w.setAttr("query_filter",E.getAttr("query"));var u=0,a=1;if(s&&s.city&&s.city.cityId){t=i(s.city);var f="";if(s.price&&s.price.value){var l=s.price.value.split(",");f+="v"+l[0],l[1]&&+l[1]>0&&(f+="v"+l[1])}if(s.star&&s.star.value)for(var c=s.star.value.length-1;c>=0;c--){var h=s.star.value[c];h&&(h=="liansuo"?o.push("liansuo=1"):h==="0|1|2"?f+="star2":f+="star"+h)}for(var c=(s.query||[]).length-1;c>=0;c--){var p=s.query[c];switch(p.type){case 3:for(var c=p.val.length-1;c>=0;c--)f+="h"+p.val[c];break;case 4:f+="location"+p.val;break;case 5:f+="zone"+p.val;break;case 6:f+="l"+p.val;break;case 9:break;case 10:for(var c=p.val.length-1;c>=0;c--)f+="g"+p.val[c];break;case 11:case 16:f+="sl"+p.val;break;case 12:p.code&&(f+="s"+p.code);break;default:}}f&&(t+=f+"/"),a=s.days||1;var v=d.Date.parse(s.inDay).format("Y-m-d"),m=(new e.base.Date(this.getServerDate())).format("Y-m-d");u=(d.Date.parse(v).valueOf()-d.Date.parse(m).valueOf())/1e3/3600/24,u<=0&&a<=1||(t+="checkin-"+a+"-"+u),o&&o.length>0&&(t+="?"+o.join("&")),this.forwardJump("searchlist",t)}else if(!w.getAttr("isSearchListWithCity")){var g=w.getAttr("address"),y=1,b=this.checkAddress(g);b?y=1:y=2;if(g.lat>0&&g.lng){y==2?t+="/webapp/hotel/oversea/searchlist/"+g.lat+"/"+g.lng+"/":t+="/webapp/hotel/searchlist/"+g.lat+"/"+g.lng+"/",a=s.days||1;var v=d.Date.parse(s.inDay).format("Y-m-d"),m=(new d.Date).format("Y-m-d");u=(d.Date.parse(v).valueOf()-d.Date.parse(m).valueOf())/1e3/3600/24,u<=0&&a<=1||(t+="checkin-"+a+"-"+u),o&&o.length>0&&(t+="?"+o.join("&")),this.forwardJump("searchlist",t)}}},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=location.search.substr(1).match(t);return n!=null?unescape(decodeURI(n[2])):null},handleQueryString:function(){var e=this,r=e.getQueryString("city");if(r&&!isNaN(r)){var i=e.getQueryString("district");n.getCityByID({id:r,did:i&&+i||-1,callback:function(n){e.locateInfo.status=!0,$("#js_city").html(n.cname),w.setAttr("address",""),w.setAttr("city",n),w.setAttr("isSearchListWithCity",!0),e.hasCityId=!0;var r=n.ctryId>1,i=t.isTwCity(n.cityId);r?e.goToOversea(n):e.goToInland(n);var s=e.getQueryString("price"),o=!i&&!r?[{key:"0-150",value:"￥150以下"},{key:"150-300",value:"￥150-￥300"},{key:"301-450",value:"￥301-￥450"},{key:"451-600",value:"￥451-￥600"},{key:"601-1000",value:"￥601-￥1000"},{key:"1000",value:"￥1000以上"}]:[{key:"0-400",value:"￥400以下"},{key:"401-700",value:"￥401-￥700"},{key:"701-1000",value:"￥701-￥1000"},{key:"1001-1300",value:"￥1001-￥1300"},{key:"1301-1800",value:"￥1301-￥1800"},{key:"1800",value:"￥1800以上"}];s&&e.containsPrice(o,s);var u=e.getQueryString("star"),a=!i&&!r?[{key:5,value:"五星级/豪华",index:1},{key:4,value:"四星级/高档",index:2},{key:3,value:"三星级/舒适",index:3},{key:2,value:"二星级及以下/经济",index:4}]:[{key:5,value:"五钻/豪华",index:1},{key:4,value:"四钻/高档",index:2},{key:3,value:"三钻/舒适",index:3},{key:2,value:"二钻及以下/经济",index:4}];u&&e.containsStar(a,u),(s||u)&&e.initPriceStar();var f=e.getQueryString("day");f&&!isNaN(f)&&f>0?(f=parseInt(f),w.setAttr("days",f)):f=1;var l=e.getQueryString("atime");if(l){var c=y.parse(l).format("Y-m-d"),h=(new y(c)).addDay(f).format("Y-m-d");w.setAttr("inDay",c),w.setAttr("outDay",h)}else{var p=e.getQueryString("relatedate");if(p!=null&&!isNaN(p)&&p>0){p=parseInt(p);var c=(new y).addDay(p).format("Y-m-d"),h=(new y(c)).addDay(f).format("Y-m-d");w.setAttr("inDay",c),w.setAttr("outDay",h)}}e.validateStoreDate(),e.updateHtmlDate();var d=e.getQueryString("brandid");d&&C.getTitles({5:[d]},function(e){e&&e[5]&&e[5][d]&&e[5][d].title&&(w.setAttr("kwText",e[5][d].title),w.setAttr("query",[{type:3,val:d}]),$("#js_kw_text_box").removeClass("hotel-fontgrey").html(e[5][d].title))},function(){});var v=e.getQueryString("zone");v&&C.getAreaInfos({mtype:1,id:v},function(e){e&&e[1]&&e[1].title&&(w.setAttr("kwText",e[1].title),w.setAttr("kwCurCatType","zoenObj"),w.setAttr("kwCurVal",v),w.setAttr("query",[{type:5,val:v}]),$("#js_kw_text_box").removeClass("hotel-fontgrey").html(e[1].title))},function(){});var m=e.getQueryString("location");m&&C.getAreaInfos({mtype:2,id:m},function(e){e&&e[2]&&e[2].title&&(w.setAttr("kwText",e[2].title),w.setAttr("kwCurCatType","locationObj"),w.setAttr("kwCurVal",m),w.setAttr("query",[{type:4,val:m}]),$("#js_kw_text_box").removeClass("hotel-fontgrey").html(e[2].title))},function(){});var g=e.getQueryString("metroid");g&&C.getAreaInfos({mtype:3,id:g},function(e){e&&e[3]&&e[3].title&&(w.setAttr("kwText",e[3].title),w.setAttr("kwCurCatType","metroLineObj"),w.setAttr("kwCurVal",{catAll:!0,catId:g,itemId:0}),w.setAttr("query",[{type:6,val:g}]),$("#js_kw_text_box").removeClass("hotel-fontgrey").html(e[3].title))},function(){})},error:function(){var e=this.needLocation();e&&this.getPosition()}})}},containsPrice:function(e,t){var n;t+="";var r=t.indexOf("-")==-1?[t]:t.split("-");if(r.length==1)r-1e3==0?n={LowPrice:r[0],HighPrice:"",html:e[5].value,index:6}:n={LowPrice:r[0],HighPrice:"",html:"￥"+r[0]+"以上",index:null};else{var i=r[0],s=r[1],o="";i-s>0&&(o=i,i=s,s=o);for(var u=0;u<e.length-1;u++){var a=e[u].key.split("-"),f=a[0],l=a[1];f-i<=0&&l-s>=0&&(n={LowPrice:i,HighPrice:s,html:e[u].value,index:u+1})}n={LowPrice:i,HighPrice:s,html:"￥"+i+"-"+"￥"+s,index:null}}n&&w.setAttr("price",{value:n.LowPrice+","+n.HighPrice,text:n.html})},containsStar:function(e,t){if(!isNaN(t)){t-2<0&&(t="2"),t-5>0&&(t="5");for(var n=0;n<e.length;n++){var r=e[n];r["key"]==t&&(t=="2"&&(t="0|1|2"),w.setAttr("star",{value:[t],text:[r.value]}))}}},eventSelectCity:function(e){this.getType()==2||this.isOverseaURL?this.forwardJump("citylist",{oversea:"oversea/"}):this.forwardJump("citylist",{})},checkAddress:function(e){var t={info:{province:[],citycode:[]}},e=_.extend(t,e),n=!0;return!e.address&&!e.info.province.length&&!e.info.citycode.length&&(n=!1),n},goToOversea:function(e,t){var n={cityId:e&&e.cityId,dstId:e&&e.did||0,cname:e&&e.cname,state:e&&e.state,ctry:e&&e.ctryCN,gps:t||{}};S.setAttr(n),this.setType(2),this.showBookRoom(),this.initPriceStar(),this.isOverseaURL||(this.isOverseaURL=!0,history.replaceState?history.replaceState(this.state,"","/webapp/hotel/oversea/"+location.search+location.hash):window.location.replace("/webapp/hotel/oversea/"+location.search+location.hash))},goToInland:function(e,n){var r=e&&e.cityId,i=n&&n.address;t.isTwCity(r)||n=="台湾省"?this.setType(3):this.setType(1),this.hideBookRoom(),this.initPriceStar(),this.isOverseaURL&&(history.replaceState?history.replaceState(this.state,"","/webapp/hotel/"+location.search+location.hash):window.location.replace("/webapp/hotel/"+location.search+location.hash),this.isOverseaURL=!1)},clearCityData:function(){var e=w.getAttr("city")||{};for(var t in e)e[t]=null;e.cname=L,w.setAttr("city",e)},checkURL:function(){var e=this.getQuery("from")||"",t=S.get();e&&e==="oversea"&&(w.setAttr("city.cityId",t.cityId||2),w.setAttr("city.did",t.dstid||0),w.setAttr("city.cname",t.cname||"上海"),w.setAttr("city.state",t.state),w.setAttr("city.ctryCN",t.ctry),this.els.city.text(t.cname||"上海"))},getAppUrl:function(){var e="/hotel_inquire",t=new RegExp("-","g"),n,r=w.getAttr("inDay").replace(t,""),i=this.getOutDate().replace(t,""),s=w.getAttr("city.cityId"),o="",u="",a="",f=0,l=w.getAttr("query");if(l&&l.length>0)for(var c=l.length,h=c-1;h>=0;h--){var p=l[h];p.type==16?o=p.val:p.type==3&&(u=p.val[0])}return n="?c1="+(r||"")+"&c2="+(i||"")+"&c3="+(s||"")+"&c4="+(o||"")+"&c5="+(u||"")+"&c6="+(a||"")+"&c7="+(f||""),e+n},validateStoreDate:function(){var e=w.get(),t=e.inDay||(new y(this.getServerDate())).format("Y-m-d"),n=this.getOutDate(),r=new Date(this.getServerDate()),i=y.getIntervalDay(r,t);i<=0&&(t=y.format(r,"Y-m-d"));var s=y.getIntervalDay(t,n),o=this.isMorning?s>=0:s>0,u=this.getDays();o||(this.isMorning&&(u=u>=1?u-1:0),n=y.parse(t).addDay(u).format("Y-m-d")),e.inDay=t,e.days=u,e.outDay=n,w.set(e),this.cidat=y.parse(t),this.codat=y.parse(n)},validateStoreGeo:function(){var e=w.getAttr("city")||{},t=k.get(),n=this;if(!e.cityId&&!t)return this.showLocating(!0),this.wannaSearchList=!0,this.getPosition(!0),!1},checkMorning:function(){var e=this,t=this.getServerDate(),n=t.getHours(),r=w.getAttr("inDay")||(new y(this.getServerDate())).format("Y-m-d"),i=this.getOutDate(),s=y.getIntervalDay(r,(new y(t)).format("Y-m-d"))===0,o=s&&n>=0&&n<6;this.getType()==2&&(o=!1);if(o){this.els.morningWrap.show();var u=1;this.isMorning=T.isMorning(),this.isMorning?(u=1,this.switchMorning({value:!0})):(u=2,this.switchMorning({value:!1})),this.morningSwitch=new f({data:[{id:1,name:"今晨6点前",value:!0},{id:2,name:"今晨6点后",value:!1}],rootBox:e.els.morningWrap.find(".hotel-morning"),selectedKey:u,changed:function(t){e.switchMorning(t,!0)}})}else this.cidat=y.parse(r),this.codat=y.parse(i),this.els.morningWrap.hide(),w.removeAttr("lastMorning"),T.setStatus(!1)},switchMorning:function(e,t){this.isMorning=e.value||!1;var n=w.get(),r=n.inDay||(new y(this.getServerDate())).format("Y-m-d"),i=this.getOutDate(this.isMorning);this.cidat=y.parse(r),this.codat=y.parse(i),n.outDay=i,w.set(n),T.setStatus(this.isMorning),this.updateHtmlDate()},getOutDate:function(e){this.isMorning=typeof e=="boolean"?e:T.isMorning();var t=w.get()||{},n=t.inDay||(new y(this.getServerDate())).format("Y-m-d"),r=this.getDays();this.isMorning&&(r=r>=1?r-1:0);var i=y.parse(n).addDay(r).format("Y-m-d");return i},getDays:function(){var e=w.getAttr("days")||1;return~~e},getRooms:function(){var e=w.getAttr("rooms")||1;return~~e},isOutlandCity:function(e){var n=0;return e||(e=w.getAttr("city")),!e||_.isEmpty(e)?!0:(n=t.validate.value("ctryId",e,0),n>1)},homeHandler:function(){if(this.getHistory().isPrevPageOrigin()){this.back();return}var e="/html5/",t=s.SalesObjectStore.getInstance(),n=parseInt((t.get()||{}).sid||0);n===1896&&(e="map://leftClick()"),this.jump(e)},init:function(){var t=this;this.els={city:this.$el.find("#js_city"),btnSearch:this.$el.find("#js_submit"),geoIcon:this.$el.find("#js_geo_icon"),geoIconLoading:this.$el.find("#js_geo_loading"),checkInDateRight:this.$el.find("#js_cki_date_right"),checkInDateLeft:this.$el.find("#js_cki_date_left"),checkOutDate:this.$el.find("#js_cko_date"),keywordsTextBox:this.$el.find("#js_kw_text_box"),priceStarTextEl:this.$el.find("#js_query_star_price").find(".hotel-m-cont"),priceStarLabelEl:this.$el.find("#js_query_star_price").find(".js_price_star_label"),morningWrap:this.$el.find("#js_morning_wrap")},this.mask=new e.ui.Mask,this.mask.addEvent("onShow",function(){$(window).bind("resize",this.onResize),this.onResize();var e=this;this.root.bind("click",function(){e.hide(),e.root.unbind("click"),t.$el.find(".js_price_star_filter").hide()})})},events:{"click .hotel-mysite":"getPosition","click #js_select_date":"showCalendar","click #js_submit":"submitAction","click #js_city":"eventSelectCity","click #js_query_kw":"go2KWCat","click #js_query_star_price":"showPriceStar","click #js_incity":"inCityAction"},onCreate:function(){this.init(),this.checkURL(),this.typeChange=function(){var e=w.get()||{};e.price=null,e.star=null,e.days=1,e.rooms=1,w.set(e)}},onLoad:function(e){r.clearHistory(this.getViewName(),location.href,2),this.isOverseaURL=/hotel\/oversea\//i.test(location.href),this.isOverseaURL?(this.pageid=b.overSea,this.showBookRoom()):(this.pageid=b.inLand,this.hideBookRoom()),this.updatePriceStarLabel(),this.checkMorning(),this.validateStoreDate(),this.initBookDay();var t=this;$("#js_locating_close").on("click",$.proxy(t.closeLocatingLayer,t));if(Lizard.P("city")){this.handleQueryString();return}var n=this.needLocation();n&&this.getPosition()},onShow:function(){var e=this;e.headerview.set({title:"国内/海外酒店",back:!0,view:e,tel:{number:4000086666},home:!0,events:{homeHandler:function(){e.homeHandler()},returnHandler:function(){e.homeHandler()}}}),this.headerview.show(),this.updateKeywords(),e.updateStoreDate(e.cidat.format("Y-m-d"),e.codat.format("Y-m-d"))},onHide:function(){m.UnSubscribe("hotel/index"),N.abort(),this.alert&&this.alert.hide(),this.stopGeoStatus(),A.hide()},showPriceStar:function(){if(this.locating===!0){this.wannaPriceStar=!0,this.showLocating(!0);return}var e=w.getAttr("city"),t=k.get();if(e&&e.cityId||t){var n=w.get()||{},r=this.getType();A.show(r,n.price,n.star,function(e,t){n.price=e,n.star=t,w.set(n)},this.els.priceStarTextEl)}else this.wannaPriceStar=!0,this.showLocating(!0),this.getPosition()},updatePriceStarLabel:function(){var e=this.getType();e||(e=this.isOverseaURL?2:1),e!=1?this.els.priceStarLabelEl.text("价格/钻级"):this.els.priceStarLabelEl.text("价格/星级")},tapCount:0,inCityAction:function(){var e=parseInt(w.getAttr("days")||0);if(e!==6)return;clearTimeout(this.__incitytimer);var t=this;this.tapCount++;if(this.tapCount>=5){this.forward("debug"),this.tapCount=0;return}this.__incitytimer=setTimeout(function(){t.tapCount=0},1e3)},showLocating:function(e){var t=this;e?$("#js_locating_close").show():$("#js_locating_close").hide(),$("#js_locating").show()},hideLocating:function(){$("#js_locating").hide()},closeLocatingLayer:function(){var e=this;e.hideLocating(),e.wannaSearchList=null,e.wannaKeyWord=null,e.wannaPriceStar=null;return},showBookRoom:function(){this.$el.find("#js_rooms_num").parents("li").show();var t=this.getRooms();_.isObject(this.roomsCount)?this.roomsCount.setVal(t):this.roomsCount=new e.ui.cuiNum({rootBox:this.$el.find("#js_rooms_num"),min:1,max:8,curNum:t,unit:"",needText:!1,changed:function(e){w.setAttr("rooms",e)}})},hideBookRoom:function(){this.$el.find("#js_rooms_num").parents("li").hide()},needLocation:function(){var e=this,n=w.getAttr("city")||{},r=k.get();if(!n.cityId&&!r)return!0;if(w.getAttr("isSearchListWithCity")===!1){e.els.city.html(L),r=k.get();if(!r)return!0;var i=this.checkAddress(r);i?e.goToInland(null,r):e.goToOversea(null,r)}else{if(!n.cityId||!t.validate.value("cname",n))return e.hasCityId=!1,!0;e.hasCityId=!0,e.els.city.html(n.cname),e.isOutlandCity(n)?e.goToOversea(n):e.goToInland(n)}return!1},initPriceStar:function(){var e=this,t=w.get()||{},n=e.getType();A.updatePriceStarSelected(n,t.price,t.star,e.els.priceStarTextEl),e.updatePriceStarLabel()},initBookDay:function(){var t=this,n=this.getDays();_.isObject(this.stayCount)?this.stayCount.setVal(n):this.stayCount=new e.ui.cuiNum({rootBox:this.$el.find("#js_cki_num"),min:1,max:28,curNum:n,unit:"",needText:!1,changed:function(e){w.setAttr("days",e),t.isMorning?t.codat=(new y(t.cidat)).addDay(e-1):t.codat=(new y(t.cidat)).addDay(e),t.updateStoreDate(t.cidat.format("Y-m-d"),t.codat.format("Y-m-d")),t.updateHtmlDate()}})}});return O});